name: 'Test bundler on stacks'
description: |
  Tests bundler dependency on its compatible stacks

inputs:
  depArtifactDir:
    description: 'directory where dependency artifact is located'
    required: true
  depArtifactName:
    description: 'dependency artifact under test (relative to dep_artifact_dir)'
    required: true

runs:
  using: 'composite'
  steps:
  - name: build bionic test
    id: build-test-bionic
    shell: bash
    run: docker build -t test-bionic -f dependency/actions/test/bionic.Dockerfile dependency/actions/test

  - name: test on bionic
    id: run-test-bionic
    shell: bash
    # todo split artifact filename with bash before passing as arguments
    run: docker run -v ${{ inputs.depArtifactDir }}:/input test-bionic --artifact "/input/${{ inputs.depArtifactName }}"

  - name: build jammy test
    id: build-test-jammy
    shell: bash
    run: docker build -t test-jammy -f dependency/actions/test/bionic.Dockerfile dependency/actions/test

  - name: test on jammy
    id: run-test-jammy
    shell: bash
    run: docker run -v ${{ inputs.depArtifactDir }}:/input test-jammy --artifact "/input/${{ inputs.depArtifactName }}"
